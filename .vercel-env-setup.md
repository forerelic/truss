# Vercel Environment Variables Setup

## Critical Issue Found

The Vercel deployment is failing with:

```
Error: Missing DATABASE_URL environment variable
```

**Status**: NO environment variables are currently set on Vercel.

## Required Environment Variables for Production

### Core Application Variables

#### 1. DATABASE_URL (REQUIRED)

- **Purpose**: PostgreSQL connection for Better Auth
- **Production Value**: `postgresql://postgres:IOlK7FZM0A0eOsIU@db.ukidaidmoabldoanzqer.supabase.co:5432/postgres`
- **Note**: For optimal production performance, consider using Supabase transaction pooler:
  ```
  postgresql://postgres.ukidaidmoabldoanzqer:IOlK7FZM0A0eOsIU@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true
  ```
  (You'll need to determine the region from your Supabase dashboard)

#### 2. NEXT_PUBLIC_SUPABASE_URL (REQUIRED)

- **Purpose**: Supabase project URL for client-side connections
- **Production Value**: `https://ukidaidmoabldoanzqer.supabase.co`

#### 3. NEXT_PUBLIC_SUPABASE_ANON_KEY (REQUIRED)

- **Purpose**: Supabase anonymous key for client-side access
- **Production Value**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVraWRhaWRtb2FibGRvYW56cWVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MTUzOTEsImV4cCI6MjA3NTQ5MTM5MX0.c5IUIEJ0kukdZ3q7fCr-5eb7lpRyeZcY9kIXB3QG_uA`

#### 4. NEXT_PUBLIC_APP_URL (REQUIRED)

- **Purpose**: Base URL for Better Auth callbacks and redirects
- **Production Value**: `https://truss-collins-projects-c5b68980.vercel.app` (or custom domain)

#### 5. BETTER_AUTH_SECRET (REQUIRED)

- **Purpose**: Secret key for Better Auth session encryption
- **Production Value**: Generate with `openssl rand -base64 32`
- **Temporary Value**: `ccBKsiONyLw3rlOAcP3CFBPaDi7rCCH8B4hYrTewgDA=`
- **⚠️ IMPORTANT**: Generate a NEW secret for production!

### Optional but Recommended

#### 6. NODE_ENV

- **Value**: `production`
- **Purpose**: Ensures production optimizations are enabled

#### 7. SUPABASE_SERVICE_ROLE_KEY (Optional)

- **Purpose**: Admin access to Supabase (bypasses RLS)
- **Note**: Only needed if using the admin client
- **Security**: NEVER expose this to the client-side

### OAuth Providers (Optional)

If you want GitHub/Google OAuth:

#### 8. GITHUB_CLIENT_ID

#### 9. GITHUB_CLIENT_SECRET

#### 10. GOOGLE_CLIENT_ID

#### 11. GOOGLE_CLIENT_SECRET

### Email Provider (Optional)

If you want email auth (magic links, verification):

#### 12. EMAIL_FROM

- Example: `noreply@your-domain.com`

#### 13. RESEND_API_KEY

- For sending auth emails via Resend

## Environment Scopes

For each environment variable, set the appropriate scopes:

- ✅ **Production**: Required for production deployments
- ⚠️ **Preview**: Optional for preview deployments (testing)
- ⚠️ **Development**: Optional for `vercel dev` (use local .env.local instead)

## Setting Variables

You can set these using:

1. **Vercel CLI** (recommended for bulk setup):

   ```bash
   vercel env add DATABASE_URL production
   # Paste value when prompted
   ```

2. **Vercel Dashboard**:
   - Go to: https://vercel.com/collins-projects-c5b68980/truss/settings/environment-variables
   - Add each variable with the appropriate scope

3. **Automated script**:
   ```bash
   bun run scripts/set-vercel-env.sh
   ```

## Post-Setup

After setting environment variables:

1. Trigger a new deployment (push to main or redeploy)
2. Check build logs to verify no env var errors
3. Test authentication flow on production URL
4. Monitor Supabase connection pool usage

## Security Notes

⚠️ **NEVER commit these values to git**
✅ **Use different secrets for staging vs production**
✅ **Rotate BETTER_AUTH_SECRET periodically**
✅ **Monitor Supabase database connection limits**
✅ **Enable Vercel Preview Protection to secure preview deployments**
